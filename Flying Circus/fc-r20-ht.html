<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="fc-r20-cs.css">
</head>

<div class="sheet-main">
	
	<!-- Game Name, and roll toggles -->
	<div class='sheet-topgrid'> 
		<h1> Flying Circus </h1>
		<span> </span>
		
		<input type="hidden" class="sheet-radio-roll-state" name="attr_rollstate" value="flat" />
		
		<button type="action" name="act_roll_state_disadvantage" class="sheet-radio-roll-state  sheet-radio-roll-state-disadvantage"> Dis
		</button>
		
		<span> </span>
		
		<button type="action" name="act_roll_state_flat" class="sheet-radio-roll-state  sheet-radio-roll-state-flat"> -
		</button>
		
		<span> </span>
		
		<button type="action" name="act_roll_state_advantage" class="sheet-radio-roll-state  sheet-radio-roll-state-advantage"> Adv
		</button>
		
		<span> </span>
		
		<label class="sheet-big-label" > Roll Mod </label>
		
		<input name="attr_roll_mod" class="sheet-stat-inputs" type="number" value="0" /> 
		
	
	</div>
	
	<!-- Spacing fix -->

	<div class="col" style="width: 100%; height: 10px;"></div>
	
    <div class='tab-container'> 
    </div>
	
	<!-- Tab Buttons -->
	<input type="radio" name="attr_tabs" value="Pilot" class="tab tab-pilot-radio" checked /><label>Pilot</label>
	<input type="radio" name="attr_tabs" value="Plane" class="tab tab-plane-radio" /><label>Plane</label>
	<input type="radio" name="attr_tabs" value="Confidants" class="tab tab-confidants-radio" /><label>Confidants</label>
	<input type="radio" name="attr_tabs" value="Roster" class="tab tab-roster-radio" /><label>Roster</label>
	<input type="radio" name="attr_tabs" value="NPC" class="tab tab-npc-radio" /><label>NPC</label>
		
	
	<!-- Spacing fix -->

	<div class="col" style="width: 100%; height: 10px;"></div>
	
	<!-- Plane tab start-->	
    <div class='tab-pilot'>
		
		<!-- Rows common to all playbooks -->	
		<div class='sheet-nameline'>
			
			<!-- Name line -->	
			<label class="sheet-left-label">Name</label> <input name="attr_character_name" class="sheet-char-inputs" type="text"/>
			<span> </span>
			<label class="sheet-left-label">Playbook</label> <select name="attr_playbook"  class="sheet-select-inputs"> <option value="farmer" selected>Farmer</option> <option value="soldier" >Soldier</option> <option value="fisher" >Fisher</option> <option value="survivor" >Survivor</option> <option value="skyborn" >Skyborn</option> <option value="believer" >Believer</option> <option value="scion" >Scion</option> <option value="worker" >Worker</option> <option value="student" >Student</option> <option value="witch" >Witch</option> </select> 
			<span> </span>
			
			<input name="attr_hard" class="sheet-stat-inputs hard" type="number" value="0" /> 
			<input name="attr_keen" class="sheet-stat-inputs keen" type="number" value="0" /> 
			<input name="attr_calm" class="sheet-stat-inputs calm" type="number" value="0" /> 
			<span> &nbsp; <input name="attr_daring" class="sheet-stat-inputs daring" type="number" value="0" /> </span>
			
			<input type="hidden" name="attr_wild" value="0">
			<input type="hidden" name="attr_playbook" class="sheet-playbook-name">
			<select name="attr_statpackage"  class="sheet-select-inputs sheet-statpackage"> <option value="devotee" class="playbook-fisher" selected>Devotee (2,-2,2,0)</option> <option value="wanderer" class="playbook-fisher" selected>Wanderer (-2,-1,4,1)</option> <option value="cryptic" class="playbook-fisher" selected>Cryptic (-1,2,3,-2)</option> <option value="shark" class="playbook-fisher" selected>Shark (3,-2,3,-2)</option>  <option value="wideeyed" class="playbook-witch" >Wide-Eyed (-1,-2,1,4,2[wild])</option> <option value="scholar" class="playbook-witch" >Scholar (-1,2,4,-3,2[wild])</option> <option value="avenger" class="playbook-witch" >Avenger (3,2,-2,-1,2[wild])</option> <option value="recluse" class="playbook-witch" >Recluse (-2,3,3,-2,2[wild])</option> <option value="bushpilot" class="playbook-farmer" >Bush Pilot (-1,2,-3,4)</option> <option value="huntsman" class="playbook-farmer" >Huntsman (3,-1,-2,2)</option>    <option value="escapist" class="playbook-farmer" >Escapist (-4,3,0,3)</option>     <option value="bumpkin" class="playbook-farmer" >Bumpkin (0,-3,3,2)</option>       <option value="blueblood" class="playbook-soldier" >Blueblood (2,-2,2,0)</option>  <option value="blowhard" class="playbook-soldier" >Blowhard (-3,4,-4,-3)</option>   <option value="recruit" class="playbook-soldier" >Recruit (1,1,0,0)</option>        <option value="professional" class="playbook-soldier" >Professional (3,0,1,-2)</option> <option value="singleminded" class="playbook-believer" >Single-Minded (3,0,-4,3)</option> <option value="intellectual" class="playbook-believer" >Intellectual (-2,3,3,-2)</option>                                                                          <option value="enforcer" class="playbook-believer" >Enforcer (3,-2,2,-1)</option>  <option value="dreamer" class="playbook-believer" >Dreamer (-3,1,2,2)</option>     <option value="wingwalker" class="playbook-skyborn" >Wingwalker (-2,-2,2,4)</option> <option value="trickster" class="playbook-skyborn" >Trickster (-3,3,-1,3)</option> <option value="defender" class="playbook-skyborn" >Defender (2,0,-2,2)</option>    <option value="trader" class="playbook-skyborn" >Trader (-1,-2,3,2)</option>       <option value="researcher" class="playbook-student" >Researcher (0,2,0,-1)</option>  <option value="inventor" class="playbook-student" >Inventor (-1,-2,2,2)</option>   <option value="tourist" class="playbook-student" >Tourist (1,1,-2,1)</option>      <option value="studybuddy" class="playbook-student" >Study Buddy (0,2,2,-3)</option>   <option value="feral" class="playbook-survivor" >Feral (3,3,-2,-2)</option>        <option value="wideeyed2" class="playbook-survivor" >Wide-Eyed (-4,3,2,1)</option>       <option value="recluse2" class="playbook-survivor" >Recluse (-2,3,3,-2)</option>         <option value="resigned" class="playbook-survivor" >Resigned (0,2,-2,2)</option>   <option value="fahnenjunker" class="playbook-scion" >Fahnenjunker (3,1,-2,0)</option>   <option value="highborn" class="playbook-scion" >Highborn (0,1,2,-1)</option>      <option value="dilettante" class="playbook-scion" >Dilettante (-1,2,2,-1)</option>      <option value="charlatan" class="playbook-scion" >Charlatan (-2,4,-2,2)</option>   <option value="jobber" class="playbook-worker" >Jobber (1,1,1,-1)</option>         <option value="worndown" class="playbook-worker" >Worn Down (2,2,2,-4)</option>          <option value="newleaseonlife" class="playbook-worker" >New Lease on Life (2,-1,-1,2)</option>                                                                          <option value="safetyinspector" class="playbook-worker" >Safety Inspector (-2,2,4,-2)</option>   </select>
			
			<!-- Age line -->	
			<label class="sheet-left-label">Age</label> <input name="attr_age" class="sheet-char-inputs" type="text"/>
			<span> </span>
			
			<label class="sheet-left-label">Pronouns</label> <input name="attr_Pronouns" class="sheet-char-inputs" type="text"/>
			<span> </span>
			
			<label class="sheet-left-label hard">Hard</label>
			<label class="sheet-left-label keen">Keen</label>
			<label class="sheet-left-label calm">Calm</label>
			<label class="sheet-left-label daring">Daring</label>
			
			<span> &nbsp; &nbsp; <input type="hidden" name="attr_hideresetstats" class="sheet-hide-stats-input" value="false" >
			<button type="action" name="act_hideresetstats_true" class="sheet-hide-stats-input sheet-stat-hide-button button-hide" > </button>
			<button type="action" name="act_hideresetstats_false" class="sheet-hide-stats-input sheet-stat-reveal-button button-reveal" > </button> &nbsp; &nbsp; &nbsp; &nbsp; <button type="action" name="act_resetstats" class="sheet-reset-stats" title="Select a starting stat package, click reset here, and then add +1 to any stat.">Reset </button> </span>
			
		</div>
		
		<!-- Spacing fix -->

		<div class="col" style="width: 100%; height: 4px;"></div>
		
		<!-- Hometown line -->	
		<div class='sheet-hometownline'>
			
			<label class="sheet-left-label">Hometown</label> <input name="attr_hometown" class="sheet-char-inputs" type="text"/>
			<span> </span>
			
			<label class="sheet-left-label">People</label> <input name="attr_people" class="sheet-char-inputs" type="text"/>
			<span> </span>
			
			<label class="sheet-left-label">Look</label> <input name="attr_look" class="sheet-char-inputs-long" type="text"/>
			<span> </span>

		</div>
		
		
		<!-- Plane line -->	
		<div class='sheet-planeline'>
			
			<label class="sheet-left-label">Plane</label> <input name="attr_plane" class="sheet-char-inputs" type="text"/>
			<span> </span>
			
			<label class="sheet-left-label">Injury</label> 
			
			<div class="injuryboxes">
			  <input checked="checked" class="radiobox reset" type="radio" name="attr_injury" value="0">
			  <input class="radiobox" type="radio" name="attr_injury" value="1">
			  <input class="radiobox" type="radio" name="attr_injury" value="2">
			  <input class="radiobox" type="radio" name="attr_injury" value="3">
			  <input class="radiobox" type="radio" name="attr_injury" value="4">
			  <input class="radiobox" type="radio" name="attr_injury" value="5">
			</div>
			
			<span> </span>
			
			<label class="sheet-left-label">Vice</label> 
			
			<div class="viceboxes">
			  <input checked="checked" class="radiobox reset" type="radio" name="attr_vice" value="0">
			  <input class="radiobox" type="radio" name="attr_vice" value="1">
			  <input class="radiobox" type="radio" name="attr_vice" value="2">
			  <input class="radiobox" type="radio" name="attr_vice" value="3">
			  <input class="radiobox" type="radio" name="attr_vice" value="4">
			  <input class="radiobox" type="radio" name="attr_vice" value="5">
			</div>
			
			<span> </span>
			
			<label class="sheet-left-label">XP</label> 
			<input name="attr_xp" class="sheet-stat-inputs" type="number" value="0" /> 

		</div>
		
		<!-- Spacing fix -->

		<div class="col" style="width: 100%; height: 4px;"></div>
		
		<!-- Stress line -->	
		<div class='sheet-stressline'>
			
			<label class="sheet-left-label">Mastery</label> 
			
			<div class="masteryboxes">
			  <input checked="checked" class="radiobox reset" type="radio" name="attr_masteryprogress" value="0">
			  <input class="radiobox" type="radio" name="attr_masteryprogress" value="1">
			  <input class="radiobox" type="radio" name="attr_masteryprogress" value="2">
			  <input class="radiobox" type="radio" name="attr_masteryprogress" value="3">
			  <input class="radiobox" type="radio" name="attr_masteryprogress" value="4">
			  <input class="radiobox" type="radio" name="attr_masteryprogress" value="5">
			</div>
			
			<span> </span>
			
			<label class="sheet-left-label">Stress</label> 
			
			<div class="stressboxes">
			  <input checked="checked" class="radiobox reset" type="radio" name="attr_stress" value="0">
			  <input class="radiobox" type="radio" name="attr_stress" value="1">
			  <input class="radiobox" type="radio" name="attr_stress" value="2">
			  <input class="radiobox" type="radio" name="attr_stress" value="3">
			  <input class="radiobox" type="radio" name="attr_stress" value="4">
			  <input class="radiobox" type="radio" name="attr_stress" value="5">
			  <input class="radiobox" type="radio" name="attr_stress" value="6">
			  <input class="radiobox" type="radio" name="attr_stress" value="7">
			  <input class="radiobox" type="radio" name="attr_stress" value="8">
			  <input class="radiobox" type="radio" name="attr_stress" value="9">
			  <input class="radiobox" type="radio" name="attr_stress" value="10">
			</div>
			

		</div>
		
		<!-- Spacing fix -->

		<div class="col" style="width: 635px; height: 4px;"></div>
		
		<!-- Pilot Moves Column - different versions depending on advantage status -->	
		<div class='sheet-pilotmoves'>
			
			<!-- repeated here for hiding to work -->
			<input type="hidden" class="sheet-radio-roll-state" name="attr_rollstate" value="flat" />
			
			<h2 class="sheet-middle-title" > On Foot Moves </h2>
			
			<button type='action' name='act_advexplorethewild' class="sheet-rollbutton daring advantage" title="When you lead the group forward into the wild">Explore the Wild</button>
			
			<button type="roll" name="roll_explorethewild" value='&{template:com} {{char=@{character_name}}} {{move=Explore the Wild}} {{showroll=[[1]]}} {{statused=Daring}} {{check=[[2d10 + @{daring} + @{roll_mod} - @{injury}}]]}} {{success=@{explorethewildsuccess}}} {{partial=@{explorethewildpartial}}} {{miss=@{genericmiss}}}' class="sheet-rollbutton daring flat" title="When you lead the group forward into the wild" > Explore the Wild </button>
			<button type="roll" name="roll_explorethewild" value='&{template:com} {{char=@{character_name}}} {{move=Explore the Wild}} {{showroll=[[1]]}} {{statused=Daring}} {{check=[[2d10 + @{daring}}]]}} {{success=@{explorethewildsuccess}}} {{partial=@{explorethewildpartial}}} {{miss=@{genericmiss}}}' class="sheet-rollbutton daring disadvantage" title="When you lead the group forward into the wild"  > Explore the Wild </button>
			
			<h2 class="sheet-middle-title" > Stress Release </h2>
			
			
			
			<h2 class="sheet-middle-title" > Other Ground Moves </h2>
			
			
			
			<h2 class="sheet-middle-title" > Universal Moves </h2>
			<button type="roll" name="roll_breaktrust" value='&{template:comtext} {{char=@{character_name}}} {{move=Break Trust}} {{movedescription=@{breaktrust}}}' class="sheet-rollbutton" title="When you lose trust in a comrade" > Break Trust</button>
			
			
			
			
			
			
			
			
			
			<h2 class="sheet-middle-title" >  </h2>
			
		</div>
		
		
		
		
		
		
		
		
		
		
	
	</div>
	
	
<!-- Plane tab start-->	
    <div class='tab-plane'>
        <div class='instrument-panel'>
            <img src="https://raw.githubusercontent.com/cbkcook/roll20-character-sheets/Flying-Circus/Flying%20Circus/fc%20panel%20fuel%20plus.jpg" alt="Flying Circus Dashboard" >
        </div>
        <!-- Altimeter-->
        <div class='alt meter token'>
            <label class='deg270'><input type="radio" name="attr_alt100" value="0" checked="checked"><span class="checkmark"></span></label>
            <label class='deg306'><input type="radio" name="attr_alt100" value="1"><span class="checkmark"></span></label>
            <label class='deg342'><input type="radio" name="attr_alt100" value="2"><span class="checkmark"></span></label>
            <label class='deg18'><input type="radio" name="attr_alt100" value="3"><span class="checkmark"></span></label>
            <label class='deg54'><input type="radio" name="attr_alt100" value="4"><span class="checkmark"></span></label>
            <label class='deg90'><input type="radio" name="attr_alt100" value="5"><span class="checkmark"></span></label>
            <label class='deg126'><input type="radio" name="attr_alt100" value="6"><span class="checkmark"></span></label>
            <label class='deg162'><input type="radio" name="attr_alt100" value="7"><span class="checkmark"></span></label>
            <label class='deg198'><input type="radio" name="attr_alt100" value="8"><span class="checkmark"></span></label>
            <label class='deg234'><input type="radio" name="attr_alt100" value="9"><span class="checkmark"></span></label>
        </div>
	
	    <div class='alt meter-inside token'>
            <label class='deg270-inside'><input type="radio" name="attr_alt1000" value="0" checked="checked"><span class="checkmark"></span></label>
            <label class='deg306-inside'><input type="radio" name="attr_alt1000" value="10"><span class="checkmark"></span></label>
            <label class='deg342-inside'><input type="radio" name="attr_alt1000" value="20"><span class="checkmark"></span></label>
            <label class='deg18-inside'><input type="radio" name="attr_alt1000" value="30"><span class="checkmark"></span></label>
            <label class='deg54-inside'><input type="radio" name="attr_alt1000" value="40"><span class="checkmark"></span></label>
            <label class='deg90-inside'><input type="radio" name="attr_alt1000" value="50"><span class="checkmark"></span></label>
            <label class='deg126-inside'><input type="radio" name="attr_alt1000" value="60"><span class="checkmark"></span></label>
            <label class='deg162-inside'><input type="radio" name="attr_alt1000" value="70"><span class="checkmark"></span></label>
            <label class='deg198-inside'><input type="radio" name="attr_alt1000" value="80"><span class="checkmark"></span></label>
            <label class='deg234-inside'><input type="radio" name="attr_alt1000" value="90"><span class="checkmark"></span></label>
        </div>
        
        <div class='alt' >
            <input name="attr_alt" class="alt-number" type="number" value="0" />
        </div>	
        <!-- Spedometer-->
        <div class='spd meter token'>
            <label class='deg270'><input type="radio" name="attr_spd10" value="0" checked="checked"><span class="checkmark"></span></label>
            <label class='deg306'><input type="radio" name="attr_spd10" value="1"><span class="checkmark"></span></label>
            <label class='deg342'><input type="radio" name="attr_spd10" value="2"><span class="checkmark"></span></label>
            <label class='deg18'><input type="radio" name="attr_spd10" value="3"><span class="checkmark"></span></label>
            <label class='deg54'><input type="radio" name="attr_spd10" value="4"><span class="checkmark"></span></label>
            <label class='deg90'><input type="radio" name="attr_spd10" value="5"><span class="checkmark"></span></label>
            <label class='deg126'><input type="radio" name="attr_spd10" value="6"><span class="checkmark"></span></label>
            <label class='deg162'><input type="radio" name="attr_spd10" value="7"><span class="checkmark"></span></label>
            <label class='deg198'><input type="radio" name="attr_spd10" value="8"><span class="checkmark"></span></label>
            <label class='deg234'><input type="radio" name="attr_spd10" value="9"><span class="checkmark"></span></label>
        </div>

        <div class='spd meter-inside token'>
            <label class='deg270-inside'><input type="radio" name="attr_spd100" value="0" checked="checked"><span class="checkmark"></span></label>
            <label class='deg306-inside'><input type="radio" name="attr_spd100" value="10"><span class="checkmark"></span></label>
            <label class='deg342-inside'><input type="radio" name="attr_spd100" value="20"><span class="checkmark"></span></label>
            <label class='deg18-inside'><input type="radio" name="attr_spd100" value="30"><span class="checkmark"></span></label>
            <label class='deg54-inside'><input type="radio" name="attr_spd100" value="40"><span class="checkmark"></span></label>
            <label class='deg90-inside'><input type="radio" name="attr_spd100" value="50"><span class="checkmark"></span></label>
            <label class='deg126-inside'><input type="radio" name="attr_spd100" value="60"><span class="checkmark"></span></label>
            <label class='deg162-inside'><input type="radio" name="attr_spd100" value="70"><span class="checkmark"></span></label>
            <label class='deg198-inside'><input type="radio" name="attr_spd100" value="80"><span class="checkmark"></span></label>
            <label class='deg234-inside'><input type="radio" name="attr_spd100" value="90"><span class="checkmark" ></span></label>
        </div>
        
        <div class='spd' >
            <input name="attr_spd" class="spd-number" type="number" value="0" />
        </div>
        <!-- Fuel -->
        <div class='fuel' >
            <input name="attr_fuel" class="plane-stat" type="text" value="0" />
            <input name="attr_fuel_max" class="plane-stat" type="text" value="0" />
        </div>
        <!-- Dry Stats -->
        <input name="attr_visibility" class="plane-stat visibility" type="text" value="0" />
        <input name="attr_stability" class="plane-stat stability" type="text" value="0" />
        <input name="attr_energy_loss" class="plane-stat energy-loss" type="text" value="0" />
        <input name="attr_turn_bleed" class="plane-stat turn-bleed" type="text" value="0" />
        <!-- Dry Stats -->
        <input name="attr_escape" class="plane-stat escape" type="text" value="0" />
        <input name="attr_crash" class="plane-stat crash" type="text" value="0" />
	    <!-- Currently Being Replaced, keeping for emergency
	    <div class='wear engine token'>
            <label class='deg0-e'><input type="radio" name="wear"><span class="checkmark"></span></label>
            <label class='deg45-e'><input type="radio" name="wear"><span class="checkmark"></span></label>
            <label class='deg90-e'><input type="radio" name="wear"><span class="checkmark"></span></label>
            <label class='deg135-e'><input type="radio" name="wear"><span class="checkmark"></span></label>
            <label class='deg180-e'><input type="radio" name="wear"><span class="checkmark"></span></label>
            <label class='deg225-e'><input type="radio" name="wear"><span class="checkmark"></span></label>
            <label class='deg270-e'><input type="radio" name="wear" checked="checked"><span class="checkmark"></span></label>
            <label class='deg315-e'><input type="radio" name="wear"><span class="checkmark"></span></label>
        </div>
	
	    <div class='rpm engine token'>
            <label class='deg0-e'><input type="radio" name="rpm"><span class="checkmark"></span></label>
            <label class='deg45-e'><input type="radio" name="rpm"><span class="checkmark"></span></label>
            <label class='deg90-e'><input type="radio" name="rpm"><span class="checkmark"></span></label>
            <label class='deg135-e'><input type="radio" name="rpm"><span class="checkmark"></span></label>
            <label class='deg180-e'><input type="radio" name="rpm"><span class="checkmark"></span></label>
            <label class='deg225-e'><input type="radio" name="rpm"><span class="checkmark"></span></label>
            <label class='deg270-e'><input type="radio" name="rpm" checked="checked"><span class="checkmark"></span></label>
            <label class='deg315-e'><input type="radio" name="rpm"><span class="checkmark"></span></label>
        </div>
        -->

    </div>
	
	
	
	
	
	
	
	
	
	
	
	
	
	<!-- Ground Move outcomes -->
	
	
	<!-- Explore the Wild possible outcomes -->
	<div class="hidden">
		<div class="sheet-action">
			<span class="sheet-action">Result 16+ : </span>
			<textarea name="attr_explorethewildsuccess" class="sheet-actiondesc" placeholder="Great Success" title="Great Success">On a hit, overcome 1 Trek. 16+, choose 2:<!--
			--><ul><!--
				--><li>Move safely and quietly.</li><!--
				--><li>If something happens, you have Advantage to Engage.</li><!--
				--><li>Overcome another Trek.</li><!--
				--><li>Leave a trail, giving Advantage to backtrack.</li><!--
			--></ul><!--
			--></textarea>
		</div>
		<div class="sheet-action">
			<span class="sheet-action">Result 11-15 : </span>
			<textarea name="attr_explorethewildpartial" class="sheet-actiondesc" placeholder="Mild Success" title="Mild Success">On a hit, overcome 1 Trek. On an 11-15, choose 1:<!--
			--><ul><!--
				--><li>Move safely and quietly.</li><!--
				--><li>If something happens, you have Advantage to Engage.</li><!--
				--><li>Overcome another Trek.</li><!--
				--><li>Leave a trail, giving Advantage to backtrack.</li><!--
			--></ul><!--
			--></textarea>
		</div>
		<!-- Generic failure listed here -->
		<div class="sheet-action">
			<span class="sheet-action">Result 10- : </span>
			<textarea name="attr_genericmiss" class="sheet-actiondesc" placeholder="Miss" title="Miss">On a miss, the GM throws a twist.
			</textarea>
		</div>
	</div>
	
	
	

	<!-- Universal Move outcomes -->
	
	<!-- Break Trust -->
	<div class="hidden">
		<div class="sheet-action">
			<span class="sheet-action">Result: </span>
			<textarea name="attr_breaktrust" class="sheet-actiondesc" placeholder="Great Success" title="Great Success"><i>When you lose trust in a comrade,</i> erase their mark and choose one:<!--
			--><ul><!--
				--><li>Keep your feelings hidden, and <u>take 1 Stress.</u></li><!--
				--><li>Show directly and explicitly how you feel, and <u>remove 1 Stress.</u> </li><!--
			--></ul><!--
			--></textarea>
		</div>
	</div>

	
	
	
	
	
</div>

</html>






<!-- Roll template -->


<rolltemplate class="sheet-rolltemplate-com">
    <table>
        <tr><th>{{char}}<br>rolls {{move}} </th></tr>
        {{#statused}}
			<tr><td><span>With </span> {{statused}}</td></tr>
		{{/statused}}
        <tr>
            <td><span>Result: </span>{{check}} </td>
        </tr>
		{{#advroll}}
		<tr>
            <td><span>Advantage Die: </span>{{advroll}} </td>
        </tr>
		{{/advroll}}
        <tr></tr>
        {{#check}}
            {{#rollTotal() showroll 1}}
                <tr>
                    <td>
                        {{#rollGreater() check 15}}
                            <span style="color: green;font-weight:bold;">Full Hit</span>
                        {{/rollGreater() check 15}}
                        {{#rollBetween() check 11 15}}
                            <span style="color: black;font-weight:bold;">Partial Hit</span>
                        {{/rollBetween() check 11 15}}
                        {{#rollLess() check 11}}
                            <span style="color: red;font-weight:bold;">Miss</span>
                        {{/rollLess() check 11}}
                    </td>
                </tr>
                {{#success}}
                    {{#rollGreater() check 15}}
                        <tr><td colspan="2"><div class="movedesc">{{success}}</div></td></tr>
                    {{/rollGreater() check 15}}
                {{/success}}
                {{#partial}}
                    {{#rollBetween() check 11 15}}
                        <tr><td colspan="2"><div class="movedesc">{{partial}}</div></td></tr>
                    {{/rollBetween() check 11 15}}
                {{/partial}}
                {{#miss}}
                    {{#rollLess() check 11}}
                        <tr><td colspan="2"><div class="movedesc">{{miss}}</div></td></tr>
                    {{/rollLess() check 11}}
                {{/miss}}
            {{/rollTotal() showroll 1}}
        {{/check}}
    </table>
</rolltemplate>


<!-- Roll template - custom roll parsing -->


<rolltemplate class="sheet-rolltemplate-comroll">
    <table>
        <tr><th>{{char}}<br>rolls {{move}} </th></tr>
        {{#statused}}
			<tr><td><span>With </span> {{statused}}</td></tr>
		{{/statused}}
        <tr>
            <td><span>Result: </span>{{computed::check}} </td>
        </tr>
		{{#advroll}}
		<tr>
            <td><span>Advantage Die: </span>{{computed::advroll}} </td>
        </tr>
		{{/advroll}}
        <tr></tr>
        {{#check}}
            {{#rollTotal() showroll 1}}
                <tr>
                    <td>
                        {{#rollGreater() computed::check 15}}
                            <span style="color: green;font-weight:bold;">Full Hit</span>
                        {{/rollGreater() computed::check 15}}
                        {{#rollBetween() computed::check 11 15}}
                            <span style="color: black;font-weight:bold;">Partial Hit</span>
                        {{/rollBetween() computed::check 11 15}}
                        {{#rollLess() computed::check 11}}
                            <span style="color: red;font-weight:bold;">Miss</span>
                        {{/rollLess() computed::check 11}}
                    </td>
                </tr>
                {{#success}}
                    {{#rollGreater() computed::check 15}}
                        <tr><td colspan="2"><div class="movedesc">{{success}}</div></td></tr>
                    {{/rollGreater() computed::check 15}}
                {{/success}}
                {{#partial}}
                    {{#rollBetween() computed::check 11 15}}
                        <tr><td colspan="2"><div class="movedesc">{{partial}}</div></td></tr>
                    {{/rollBetween() computed::check 11 15}}
                {{/partial}}
                {{#miss}}
                    {{#rollLess() computed::check 11}}
                        <tr><td colspan="2"><div class="movedesc">{{miss}}</div></td></tr>
                    {{/rollLess() computed::check 11}}
                {{/miss}}
            {{/rollTotal() showroll 1}}
        {{/check}}
    </table>
</rolltemplate>

<!-- Roll template - version for when there is only text, no rolling -->


<rolltemplate class="sheet-rolltemplate-comtext">
    <table>
        <tr><th>{{char}}<br>rolls {{move}}</th></tr>
        {{#movedescription}}

             <tr><td colspan="2"><div class="movedesc">{{movedescription}}</div></td></tr>
             
        {{/movedescription}}
    </table>
</rolltemplate>






<script type="text/worker">
  
  const initiateRoll = async function(event){
  
  let [section,rowID,button] = parseClickTrigger(event.triggerName);//Returns an array with values of ['repeating_section','rowID','button name']
    let message = `&{template:comroll} {{showroll=[[1]]}}  {{check=[[0[computed result]]]}} {{advroll=[[0[computed roll]]]}} {{roll1=[[1d10]]}} {{roll2=[[1d10]]}} {{roll3=[[1d10]]}} ${rollContent[button]}`;
    let roll = await startRoll(message);
    const computeObj = {};
	
  //const roll = await startRoll('&{template:comroll} {{showroll=[[1]]}}  {{check=[[0[computed result]]]}} {{advroll=[[0[computed roll]]]}} {{roll1=[[1d10]]}} {{roll2=[[1d10]]}} {{roll3=[[1d10]]}}');
  //const computeObj = {};
  
  let rollResults = [1,2,3].map((num)=>roll.results[`roll${num}`]);
  console.log(rollResults);
  let result = rollResults.map(a => a.result);
  console.log(result);
  let lowerResults = [];
  var max1 = Math.max.apply(null, result); // get the max of the array
  console.log(max1);
  let rollResultsReduce = result.splice(result.indexOf(max1), 1); // remove max from the array
  console.log(rollResultsReduce);
  let max2 =  Math.max.apply(null, rollResultsReduce);
  console.log(max2);
  computeObj.check = max1 + max2;
  
  computeObj.advroll = _.last(result);//Get the last die - the advantage die's result
  finishRoll(roll.rollId,computeObj);
};

const parseClickTrigger = function(string){
  let match = string.match(/clicked:(?:(repeating_[^_]+)_([^_]+)_)?(.+)/);
  match.shift();
  return match;
};
const rollContent = {
    advexplorethewild:'{{success=@{explorethewildsuccess}}} {{partial=@{explorethewildpartial}}}',
    acrobatics:`{{success=@{acrobaticssuccess}}} {{partial=@{acrobaticspartial}}}`
};

const rollButtonsAdv = ["advexplorethewild"];
rollButtonsAdv.forEach((button)=>{
    on(`clicked:${button}`,initiateRoll);
});

  
  
  const rollStateRadioValues = ["advantage","flat","disadvantage"];
  rollStateRadioValues.forEach(function(value) {
    on(`clicked:roll_state_${value}`, function() {
      setAttrs({
        ["rollstate"]: value
      });
    });
  });
  
  const statHideValues = ["true","false"];
  statHideValues.forEach(function(value) {
    on(`clicked:hideresetstats_${value}`, function() {
      setAttrs({
        ["hideresetstats"]: value
      });
    });
  });
  
  //Reset Stats to starting stats for selected stat package (by playbook)
	const attributes = ["statpackage","hard","keen","calm","daring","wild"];
	on('clicked:resetstats', () => {
		
		getAttrs(attributes, function(values) {
			const statpackage = values.statpackage.trim();
			let hardnew = values.hard || 0;
			let keennew = values.keen || 0;
			let calmnew = values.calm || 0;
			let daringnew = values.daring || 0;
			let wildnew = values.wild || 0;
			
			if (statpackage === "devotee") {
		
				hardnew = 2;
				keennew = -2;
				calmnew = 2;
				daringnew = 0;
				wildnew = 0;
			}
			else if (statpackage === "wanderer") {
		
				hardnew = -2;
				keennew = -1;
				calmnew = 4;
				daringnew = 1;
				wildnew = 0;
			}
			else if (statpackage === "cryptic") {
		
				hardnew = -1;
				keennew = 2;
				calmnew = 3;
				daringnew = -2;
				wildnew = 0;
			}
			else if (statpackage === "shark") {
		
				hardnew = 3;
				keennew = -2;
				calmnew = 3;
				daringnew = -2;
				wildnew = 0;
			}
			else if (statpackage === "wideeyed") {
		
				hardnew = -1;
				keennew = -2;
				calmnew = 1;
				daringnew = 4;
				wildnew = 2;
			}
			else if (statpackage === "scholar") {
		
				hardnew = -1;
				keennew = 2;
				calmnew = 4;
				daringnew = -3;
				wildnew = 2;
			}
			else if (statpackage === "avenger") {
		
				hardnew = 3;
				keennew = 2;
				calmnew = -2;
				daringnew = -1;
				wildnew = 2;
			}
			else if (statpackage === "recluse") {
		
				hardnew = -2;
				keennew = 3;
				calmnew = 3;
				daringnew = -2;
				wildnew = 2;
			}
			else if (statpackage === "bushpilot") {
		
				hardnew = -1;
				keennew = 2;
				calmnew = -3;
				daringnew = 4;
				wildnew = 0;
			}
			else if (statpackage === "huntsman") {
		
				hardnew = 3;
				keennew = -1;
				calmnew = -2;
				daringnew = 2;
				wildnew = 0;
			}
			else if (statpackage === "escapist") {
		
				hardnew = -4;
				keennew = 3;
				calmnew = 0;
				daringnew = 3;
				wildnew = 0;
			}
			else if (statpackage === "bumpkin") {
		
				hardnew = 0;
				keennew = -3;
				calmnew = 3;
				daringnew = 2;
				wildnew = 0;
			}
			else if (statpackage === "blueblood") {
		
				hardnew = 2;
				keennew = -2;
				calmnew = 2;
				daringnew = 0;
				wildnew = 0;
			}
			else if (statpackage === "blowhard") {
		
				hardnew = -3;
				keennew = 4;
				calmnew = 4;
				daringnew = -3;
				wildnew = 0;
			}
			else if (statpackage === "recruit") {
		
				hardnew = 1;
				keennew = 1;
				calmnew = 0;
				daringnew = 0;
				wildnew = 0;
			}
			else if (statpackage === "professional") {
		
				hardnew = 3;
				keennew = 0;
				calmnew = 1;
				daringnew = -2;
				wildnew = 0;
			}
			else if (statpackage === "singleminded") {
		
				hardnew = 3;
				keennew = 0;
				calmnew = -4;
				daringnew = 3;
				wildnew = 0;
			}
			else if (statpackage === "intellectual") {
		
				hardnew = -2;
				keennew = 3;
				calmnew = 3;
				daringnew = -2;
				wildnew = 0;
			}
			else if (statpackage === "enforcer") {
		
				hardnew = 3;
				keennew = -2;
				calmnew = 2;
				daringnew = -1;
				wildnew = 0;
			}
			else if (statpackage === "dreamer") {
		
				hardnew = -3;
				keennew = 1;
				calmnew = 2;
				daringnew = 2;
				wildnew = 0;
			}
			else if (statpackage === "wingwalker") {
		
				hardnew = -2;
				keennew = -2;
				calmnew = 2;
				daringnew = 4;
				wildnew = 0;
			}
			else if (statpackage === "trickster") {
		
				hardnew = -3;
				keennew = 3;
				calmnew = -1;
				daringnew = 3;
				wildnew = 0;
			}
			else if (statpackage === "defender") {
		
				hardnew = 2;
				keennew = 0;
				calmnew = -2;
				daringnew = 2;
				wildnew = 0;
			}
			else if (statpackage === "trader") {
		
				hardnew = -1;
				keennew = -2;
				calmnew = 3;
				daringnew = 2;
				wildnew = 0;
			}
			else if (statpackage === "researcher") {
		
				hardnew = 0;
				keennew = 2;
				calmnew = 0;
				daringnew = -1;
				wildnew = 0;
			}
			else if (statpackage === "inventor") {
		
				hardnew = -1;
				keennew = -2;
				calmnew = 2;
				daringnew = 2;
				wildnew = 0;
			}
			else if (statpackage === "tourist") {
		
				hardnew = 1;
				keennew = 1;
				calmnew = -2;
				daringnew = 1;
				wildnew = 0;
			}
			else if (statpackage === "studybuddy") {
		
				hardnew = 0;
				keennew = 2;
				calmnew = 2;
				daringnew = -3;
				wildnew = 0;
			}
			else if (statpackage === "feral") {
		
				hardnew = 3;
				keennew = 3;
				calmnew = -2;
				daringnew = -2;
				wildnew = 0;
			}
			else if (statpackage === "wideeyed2") {
		
				hardnew = -4;
				keennew = 3;
				calmnew = 2;
				daringnew = 1;
				wildnew = 0;
			}
			else if (statpackage === "recluse2") {
		
				hardnew = -2;
				keennew = 3;
				calmnew = 3;
				daringnew = -2;
				wildnew = 0;
			}
			else if (statpackage === "resigned") {
		
				hardnew = 0;
				keennew = 2;
				calmnew = -2;
				daringnew = 2;
				wildnew = 0;
			}
			else if (statpackage === "fahnenjunker") {
		
				hardnew = 3;
				keennew = 1;
				calmnew = -2;
				daringnew = 0;
				wildnew = 0;
			}
			else if (statpackage === "highborn") {
		
				hardnew = 0;
				keennew = 1;
				calmnew = 2;
				daringnew = -1;
				wildnew = 0;
			}
			else if (statpackage === "dilettante") {
		
				hardnew = -1;
				keennew = 2;
				calmnew = 2;
				daringnew = -1;
				wildnew = 0;
			}
			else if (statpackage === "charlatan") {
		
				hardnew = -2;
				keennew = 4;
				calmnew = -2;
				daringnew = 2;
				wildnew = 0;
			}
			else if (statpackage === "jobber") {
		
				hardnew = 1;
				keennew = 1;
				calmnew = 1;
				daringnew = 1;
				wildnew = 0;
			}
			else if (statpackage === "worndown") {
		
				hardnew = 2;
				keennew = 2;
				calmnew = 2;
				daringnew = -4;
				wildnew = 0;
			}
			else if (statpackage === "newleaseonlife") {
		
				hardnew = 2;
				keennew = -1;
				calmnew = -1;
				daringnew = 2;
				wildnew = 0;
			}
			else if (statpackage === "safetyinspector") {
		
				hardnew = -2;
				keennew = 2;
				calmnew = 4;
				daringnew = -2;
				wildnew = 0;
			}
			
			setAttrs({
				hard: hardnew,
				keen: keennew,
				calm: calmnew,
				daring: daringnew,
				wild: wildnew
			});
		
		});
		
		
	});
	on("change:alt sheet:opened", function() {
        getAttrs(["alt"], function(values) {
            let a = parseInt(values.alt)||0;
            let hund = a % 10;
            let thou = a - hund;
            setAttrs({                            
		        alt100: hund,
			    alt1000: thou
		    });
        });
    });
    
    on("change:alt100 change:alt1000", function() {
        getAttrs(["alt100", "alt1000"], function(values) {
            let hund = parseInt(values.alt100)||0;
            let thou = parseInt(values.alt1000)||0;
            let a = hund + thou;
            setAttrs({                            
		        alt: a
		    });
        });
    });
    
    on("change:spd sheet:opened", function() {
        getAttrs(["spd"], function(values) {
            let s = parseInt(values.spd)||0;
            let tens = s % 10;
            let hund = s - tens;
            setAttrs({                            
		        spd10: tens,
			    spd100: hund
		    });
        });
    });
    
    on("change:spd10 change:spd100", function() {
        getAttrs(["spd10", "spd100"], function(values) {
            let tens = parseInt(values.spd10)||0;
            let hund = parseInt(values.spd100)||0;
            let s = hund + tens;
            setAttrs({                            
		        spd: s
		    });
        });
    })
</script>
